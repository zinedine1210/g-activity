{"version":3,"file":"index.umd.js","sources":["../src/collaboration-cursor.ts"],"sourcesContent":["import { Extension } from '@tiptap/core'\nimport { yCursorPlugin } from 'y-prosemirror'\n\ntype CollaborationCursorStorage = {\n  users: { clientId: number, [key: string]: any }[],\n}\n\nexport interface CollaborationCursorOptions {\n  provider: any,\n  user: Record<string, any>,\n  render (user: Record<string, any>): HTMLElement,\n  /**\n   * @deprecated The \"onUpdate\" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor\n   */\n  onUpdate: (users: { clientId: number, [key: string]: any }[]) => null,\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    collaborationCursor: {\n      /**\n       * Update details of the current user\n       */\n      updateUser: (attributes: Record<string, any>) => ReturnType,\n      /**\n       * Update details of the current user\n       *\n       * @deprecated The \"user\" command is deprecated. Please use \"updateUser\" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor\n       */\n      user: (attributes: Record<string, any>) => ReturnType,\n    }\n  }\n}\n\nconst awarenessStatesToArray = (states: Map<number, Record<string, any>>) => {\n  return Array.from(states.entries()).map(([key, value]) => {\n    return {\n      clientId: key,\n      ...value.user,\n    }\n  })\n}\n\nconst defaultOnUpdate = () => null\n\nexport const CollaborationCursor = Extension.create<CollaborationCursorOptions, CollaborationCursorStorage>({\n  name: 'collaborationCursor',\n\n  addOptions() {\n    return {\n      provider: null,\n      user: {\n        name: null,\n        color: null,\n      },\n      render: user => {\n        const cursor = document.createElement('span')\n\n        cursor.classList.add('collaboration-cursor__caret')\n        cursor.setAttribute('style', `border-color: ${user.color}`)\n\n        const label = document.createElement('div')\n\n        label.classList.add('collaboration-cursor__label')\n        label.setAttribute('style', `background-color: ${user.color}`)\n        label.insertBefore(document.createTextNode(user.name), null)\n        cursor.insertBefore(label, null)\n\n        return cursor\n      },\n      onUpdate: defaultOnUpdate,\n    }\n  },\n\n  onCreate() {\n    if (this.options.onUpdate !== defaultOnUpdate) {\n      console.warn('[tiptap warn]: DEPRECATED: The \"onUpdate\" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')\n    }\n  },\n\n  addStorage() {\n    return {\n      users: [],\n    }\n  },\n\n  addCommands() {\n    return {\n      updateUser: attributes => () => {\n        this.options.user = attributes\n\n        this.options.provider.awareness.setLocalStateField('user', this.options.user)\n\n        return true\n      },\n      user: attributes => ({ editor }) => {\n        console.warn('[tiptap warn]: DEPRECATED: The \"user\" command is deprecated. Please use \"updateUser\" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')\n\n        return editor.commands.updateUser(attributes)\n      },\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      yCursorPlugin(\n        (() => {\n          this.options.provider.awareness.setLocalStateField('user', this.options.user)\n\n          this.storage.users = awarenessStatesToArray(this.options.provider.awareness.states)\n\n          this.options.provider.awareness.on('update', () => {\n            this.storage.users = awarenessStatesToArray(this.options.provider.awareness.states)\n          })\n\n          return this.options.provider.awareness\n        })(),\n        // @ts-ignore\n        {\n          cursorBuilder: this.options.render,\n        },\n      ),\n    ]\n  },\n})\n"],"names":["Extension","yCursorPlugin"],"mappings":"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"}